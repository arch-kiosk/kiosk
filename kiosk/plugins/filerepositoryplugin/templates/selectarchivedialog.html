{% extends "basicmodaldialog.html" %}
{% block dialog_css %}
    <link rel=stylesheet href="/filerepository/static/selectarchivedialog.css" type="text/css">
{% endblock %}
{% block kiosk_modal_dialog_id %}id="fr-select-archive-dialog"{% endblock %}
{% block kiosk_modal_dialog_classes %}kiosk-modal-dialog-fullscreen{% endblock %}
{% block kiosk_modal_dialog_name %}{{ title }}{% endblock %}
{% block kiosk_modal_dialog_image %}
    <!--Vectors and icons https://www.svgrepo.com/svg/507917/archive"
    COLLECTION: Scarlab Duotone Line Vectors
    LICENSE: MIT License
    AUTHOR: scarlab-->
    <svg width="64px" height="64px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path opacity="0.1"
              d="M4 9V16C4 17.8856 4 18.8284 4.58579 19.4142C5.17157 20 6.11438 20 8 20H16C17.8856 20 18.8284 20 19.4142 19.4142C20 18.8284 20 17.8856 20 16V9H4Z"
              fill="#323232" />
        <path d="M9 13H15" stroke="#323232" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
        <path
            d="M3 6.5C3 6.03534 3 5.80302 3.03843 5.60982C3.19624 4.81644 3.81644 4.19624 4.60982 4.03843C4.80302 4 5.03534 4 5.5 4H12H18.5C18.9647 4 19.197 4 19.3902 4.03843C20.1836 4.19624 20.8038 4.81644 20.9616 5.60982C21 5.80302 21 6.03534 21 6.5V6.5V6.5C21 6.96466 21 7.19698 20.9616 7.39018C20.8038 8.18356 20.1836 8.80376 19.3902 8.96157C19.197 9 18.9647 9 18.5 9H12H5.5C5.03534 9 4.80302 9 4.60982 8.96157C3.81644 8.80376 3.19624 8.18356 3.03843 7.39018C3 7.19698 3 6.96466 3 6.5V6.5V6.5Z"
            stroke="#323232" stroke-width="2" stroke-linejoin="round" />
        <path
            d="M4 9V15.9999C4 17.8856 4 18.8284 4.58579 19.4142C5.17157 19.9999 6.11438 19.9999 8 19.9999H9H15H16C17.8856 19.9999 18.8284 19.9999 19.4142 19.4142C20 18.8284 20 17.8856 20 15.9999V9"
            stroke="#323232" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
    </svg>
{% endblock %}
{% block kiosk_modal_dialog_content %}
    <div id="sarch-dialog" class="pagecontrol-content">
        <form id="sarch-dialog-form">
            {{ select_archive_dialog_form.csrf_token }}
            <div class="grid-12">
                {{ select_archive_dialog_form.selected_archive(
                                class="kiosk-dialog-textfield",
                                errclass="kiosk-error-border",
                                labelclass="kiosk-dialog-label") }}
            </div>
        </form>
    </div>
{% endblock %}

{% block kiosk_modal_dialog_after %}
    {% include "_kioskmodaldialog_api_connector_include.html" %}
    <script>

        function popupApiConnected(api) {
            initDialog();
        }

        function popupApiFailed() {
            kioskErrorToast("Could not connect to the Kiosk API. The dialog cannot be initialized. Maybe try again?");
            $.magnificPopup.close();
        }

        function initDialog() {
            // inject_loader_div($("#image-spinner"), "white", 50, 50);
            bindReturnKeyToButtons("fr-select-archive-dialog", "ef-ok", ["ef-cancel"]);
            kioskShowFooter(true);
            kioskActivateButton($("#bt-next"), null);
            kioskActivateButton($("#bt-back"), null);
            kioskActivateButton($("#bt-close"), null);
            kioskActivateButton($("#bt-delete"), null);

            kioskActivateButton($("#bt-cancel"), () => {
                $.magnificPopup.close();
            });
            kioskActivateButton($("#bt-ok"), setArchiveSelector);
            frInitArchiveSelectorDialog();
        }

        function frInitArchiveSelectorDialog() {
            document.getElementsByClassName("dialog-modal-buttons")[0].style.visibility="visible";
        }

        function setArchiveSelector() {
            const frm = document.querySelector("#sarch-dialog-form");
            $.post("/filerepository/selectarchive", $(frm).serialize(), (data) => {
                $.magnificPopup.close();
                clearAllFileMarkers()
                if (data.success) {

                    setTimeout(() => {
                        $("#frf").submit();
                    },50)
                }
            })
        }
    </script>
{% endblock %}